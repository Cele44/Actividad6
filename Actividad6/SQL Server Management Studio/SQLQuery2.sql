--DDL (LENGUAJE DE DEFINICION DE DATOS):CREATE, ALTER, DROP, TRUNCATE
CREATE DATABASE ARBOLGENE;
GO
USE ARBOLGENE;
GO
-- Crear tabla Persona
CREATE TABLE PERSONA(
    ID_PERSONA INT NOT NULL IDENTITY(1,1)PRIMARY KEY,
    NOMBRES VARCHAR(25),
    APELLIDO_PATERNO VARCHAR (25),
	APELLIDO_MATERNO VARCHAR (25),
	CI VARCHAR (25),
	EXPEDIDO VARCHAR(10),
	SEXO CHAR (1) NOT NULL,
	FECHA_NACIMIENTO DATE);
GO
CREATE TABLE TIPO_RELACION(
   ID_TIRELACION INT NOT NULL IDENTITY PRIMARY KEY,
   DESCRIPCION VARCHAR(50));
GO
CREATE TABLE RELACION(
  --ID_RELACION INT NOT NULL IDENTITY,
  ID_PP INT,
  ID_TR INT,
  ID_PH INT,
  --PRIMARY KEY (ID_RELACION),
  FOREIGN KEY(ID_PP)REFERENCES PERSONA(ID_PERSONA),
  FOREIGN KEY(ID_TR)REFERENCES TIPO_RELACION(ID_TIRELACION),
  FOREIGN KEY(ID_PH)REFERENCES PERSONA(ID_PERSONA)
  
  );
GO


-- DATOS PERSONA
INSERT INTO PERSONA(NOMBRES, APELLIDO_PATERNO,APELLIDO_MATERNO,CI,EXPEDIDO,SEXO,FECHA_NACIMIENTO) 
VALUES
       ('ROSAURA','GARECA','TOLABA','94878378','TJ','M','19/06/1918'),
	   ('TOMAS','CADENA','RUIZ','60246478','TJ','H','11/05/1917'),
	   ('ANA MARIA','CADENA','GARECA','12378904','TJ','M','05/11/1951'),
	   ('ROBERTO','CADENA','GUERRRO','68903231','TJ','H','11/05/1949'),
       ('RAQUEL','CADENA','CADENA','18975432','TJ','M','12/06/1979'),
	   ('JUAN','ORTIZ','BAUTISTA','24678902','CH','H','28/08/1974'),
	   ('CELESTE CAMILA','ORTIZ','CADENA','76879890','TJ','M','06/04/2003'),
	   ('WENDY ANGELINA','ORTIZ','CADENA','35566882','TJ','M','05/04/2012'),
	   ('MARTHA','CADENA','CADENA','56789021','TJ','M','19/04/1942'),
	   ('DOMINGO','CADENA','CADENA','65432197','TJ','H','09/06/1937'),
	   ('MARIA JOSE',NULL,'CADENA','10674525 C','TJ','M','28/08/2016'),
	   ('CRISTIAN','CADENA','RODRIGUEZ','56432179','TJ','H','05/03/2009');

DELETE FROM PERSONA WHERE ID_PERSONA>= 13;

INSERT INTO TIPO_RELACION(DESCRIPCION) VALUES
('Padre'),
('Madre'),
('Abuelo'),
('Abuela'),
('Hijo'),
('Hija'),
('Hermano'),
('Hermana'),
('Nieto'),
('Nieta'),
('Bisabuelo'),
('Bisabuela'),
('Bisnieto'),
('Bisnieta'),
('Tío'),
('Tía'),
('Primo'),
('Prima'),
('Esposo'),
('Esposa');
INSERT INTO TIPO_RELACION(DESCRIPCION) VALUES
('Cuñado'),
('Cuñada'),
('Yerno'),
('Suegro'),
('Suegra'),
('Sobrino'),
('Sobrina');

-- RELACIONES
INSERT INTO RELACION(ID_PP,ID_TR,ID_PH) VALUES
(1,2,3),---rosaura
(1,4,5),
(1,4,9),
(1,4,10),
(1,12,7),
(1,12,8),
(1,12,11),
(1,12,12),
(1,20,2),
(2,1,3),-----tomas
(2,3,5),
(2,3,9),
(2,3,10),
(2,11,7),
(2,11,8),
(2,11,11),
(2,11,12),
(2,19,1),
(3,6,1),--maria
(3,6,2),
(3,2,5),
(3,2,9),
(3,2,10),
(3,4,7),
(3,4,8),
(3,4,11),
(3,4,12),
(3,20,4),
(3,25,6),
(4,1,5),-----roberto
(4,1,9),
(4,1,10),
(4,3,7),
(4,3,8),
(4,3,11),
(4,3,12),
(4,19,3),
(4,24,6),
(5,2,7),---raquel
(5,2,8),
(5,6,3),
(5,6,4),
(5,10,1),
(5,10,2),
(5,8,9),
(5,8,10),
(5,16,11),
(5,16,12),
(5,20,6),
(6,1,7),----juan
(6,1,8),
(6,15,11),
(6,15,12),
(6,19,5),
(6,23,3),
(6,23,4),
(6,21,9),
(6,21,10),
(7,6,5),---celeste
(7,6,6),
(7,8,8),
(7,10,3),
(7,10,4),
(7,18,11),
(7,18,12),
(7,14,1),
(7,14,2),
(7,27,9),
(7,27,10),
(8,6,5),----wendy
(8,6,6),
(8,8,7),
(8,10,3),
(8,10,4),
(8,18,11),
(8,18,12),
(8,14,1),
(8,14,2),
(8,27,9),
(8,27,10),
(9,6,3),---martha
(9,6,4),
(9,2,11),
(9,10,1),
(9,10,2),
(9,8,5),
(9,8,10),
(9,16,7),
(9,16,8),
(9,16,12),
(9,22,6),
(10,5,3),--domingo    
(10,5,4),
(10,2,12),
(10,9,1),
(10,9,2),
(10,7,5),
(10,7,9),
(10,15,7),
(10,15,8),
(10,15,11),
(10,21,6),
(11,6,9),---mjose
(11,10,3),
(11,10,4),
(11,18,7),
(11,18,8),
(11,18,12),
(11,14,1),
(11,14,2),
(11,27,5),
(11,27,6),
(11,27,10),
(12,5,9),---cristian
(12,9,3),
(12,9,4),
(12,17,7),
(12,17,8),
(12,17,11),
(12,13,1),
(12,13,2),
(12,26,5),
(11,26,6),
(11,26,9);


SELECT B.NOMBRES AS BisabueloNombres, B.APELLIDO_PATERNO AS BisabueloApellidoPaterno, B.APELLIDO_MATERNO AS BisabueloApellidoMaterno
FROM PERSONA B
JOIN RELACION R1 ON B.ID_PERSONA = R1.ID_PP
JOIN RELACION R2 ON R1.ID_PH = R2.ID_PP
JOIN PERSONA BNieto ON R2.ID_PH = BNieto.ID_PERSONA
WHERE BNieto.ID_PERSONA = 12AND R1.ID_TR IN (
    SELECT ID_TIRELACION FROM TIPO_RELACION WHERE DESCRIPCION IN ('Bisabuelo', 'Bisabuela')AND B.ID_PERSONA NOT IN (12,BNIETO.ID_PERSONA)
);
SELECT BNIETO.ID_PERSONA, BNIETO.NOMBRES, BNIETO.APELLIDO_PATERNO, BNIETO.APELLIDO_MATERNO
FROM PERSONA BNIETO
JOIN RELACION R1 ON BNIETO.ID_PERSONA = R1.ID_PP
JOIN RELACION R2 ON R1.ID_PH = R2.ID_PP
JOIN PERSONA ABUELO ON R2.ID_PP = ABUELO.ID_PERSONA
WHERE R1.ID_TR IN (SELECT ID_TIRELACION FROM TIPO_RELACION WHERE DESCRIPCION IN ('Bisnieto', 'Bisnieta'))
ORDER BY BNIETO.ID_PERSONA;